@page "/song-requests"
@using Microsoft.AspNetCore.Components.QuickGrid;

<PageTitle>Song requests</PageTitle>

@inject NavigationManager NavigationManager
@inject ISongRequestsRepository SongRequestRepository

<h3>Song requests</h3>
<br />
@if (songRequests is not null)
{
    <QuickGrid Items="songRequests.AsQueryable()" Pagination="paginationState">
        <PropertyColumn Property="s => s.Artist" Sortable="true"></PropertyColumn>
        <PropertyColumn Property="s => s.Title" Sortable="true"></PropertyColumn>
        <PropertyColumn Property="s => s.Genre" Sortable="true"></PropertyColumn>
        <PropertyColumn Property="s => s.Language" Sortable="true"></PropertyColumn>
        <TemplateColumn>
            <a href="/song-request/@context.Id" class="btn btn-link">Edit</a>
        </TemplateColumn>
        <TemplateColumn>
            <ChildContent Context="songRequest">
                <EditForm Model="songRequest"
                          FormName="@($"form-song-request-{songRequest.Id}")"
                          OnValidSubmit="@(() => { Delete(songRequest.Id); })">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </EditForm>
            </ChildContent>
        </TemplateColumn>
    </QuickGrid>
    <Paginator State="paginationState"></Paginator>
    <div>
        <a href="/song-request" class="btn btn-primary">Add Song request</a>
    </div>
}

@code {
    private List<SongRequest>? songRequests;

    private PaginationState paginationState = new PaginationState{ ItemsPerPage = 3 };
    
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            songRequests = SongRequestRepository.GetAll();
            StateHasChanged();
        }
    }

    private void Delete(int id)
    {
        if (id > 0)
        {
            SongRequestRepository.Delete(id);
            // Used to refresh the page
            //NavigationManager.NavigateTo("/song-requests", true);
        }
    }
}